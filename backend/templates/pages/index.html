{% extends 'layouts/base.html' %}

{% block title %}Recherche – Bibliothèque de jeux{% endblock %}

{% block content %}
<section class="panel">
  <div class="panel-header">
    <div>
      <p class="eyebrow">Recherche intelligente</p>
      <h1>Explique ton besoin, on trouve les jeux adaptés</h1>
      <p class="lead">Rédige ta demande en français et l’IA s’occupe du reste.</p>
    </div>
  </div>

  <form
    class="search-bar"
    hx-get="{{ url_for('ui.render_games_table') }}"
    hx-target="#search-results"
    hx-indicator="#search-indicator"
  >
    <input
      type="text"
      name="question"
      value="{{ question }}"
      placeholder="ex : je veux un coopératif en moins de 15 minutes pour 4 joueurs"
      aria-label="Question en français"
    />
    <input type="hidden" name="view" value="search" />
    <button type="submit" class="primary">Chercher</button>
  </form>
  <details class="sql-toggle">
    <summary>Affiner avec du SQL (optionnel)</summary>
    <label>
      <span class="text-muted">Requête SQL</span>
      <textarea name="sql" rows="3" placeholder="SELECT * FROM jeux WHERE joueurs_min &gt;= 4">{{ sql }}</textarea>
    </label>
  </details>
  <div class="bar-actions">
    <button type="button" class="ghost" hx-get="{{ url_for('ui.render_games_table') }}" hx-target="#search-results" hx-indicator="#search-indicator">Réinitialiser</button>
    <div id="search-indicator" class="htmx-indicator">Recherche en cours…</div>
  </div>

  <div id="search-message">
    {% if result.source != 'default' %}
      <div class="alert alert-info">
        Résultat obtenu via {{ 'la question' if result.source == 'question' else 'la requête SQL' }}.
      </div>
    {% endif %}
  </div>

  <div id="search-results">
    {% with games=result.games, show_actions=False %}
      {% include 'partials/game_table.html' %}
    {% endwith %}
  </div>
</section>
{% endblock %}
